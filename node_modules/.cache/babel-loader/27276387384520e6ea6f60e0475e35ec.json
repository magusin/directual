{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\Hugo\\\\code\\\\akatek\\\\directual\\\\directual-react-boilerplate\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext,createContext}from\"react\";import Directual from'directual-api';var api=new Directual({apiHost:'/'});export var authContext=createContext();export function ProvideAuth(_ref){var children=_ref.children;var auth=useProvideAuth();return/*#__PURE__*/React.createElement(authContext.Provider,{value:auth},children);}export var useAuth=function useAuth(){return useContext(authContext);};// Provide hook that creates auth object and handles state\nfunction useProvideAuth(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),sessionID=_useState4[0],setSessionID=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),role=_useState6[0],setRole=_useState6[1];var login=function login(username,password){return api.auth.login(username,password).then(function(res){setUser(res.username);setSessionID(res.sessionID);setRole(res.role);window.localStorage.setItem('sid',res.sessionID);});};var signout=function signout(cb){return api.auth.logout('').then(function(res){setUser(null);setRole(null);setSessionID(null);window.localStorage.setItem('sid',null);cb();});};var isAutorised=function isAutorised(){return!!user;};var hasRole=function hasRole(roleCheck){if(!roleCheck){return true;}return role===roleCheck;};useEffect(function(){var sid=window.localStorage.getItem('sid')||'';api.auth.isAuthorize(sid,function(status,token){if(status===true){setUser(token.username);setSessionID(token.token);setRole(token.role);}});},[]);return{user:user,sessionID:sessionID,login:login,isAutorised:isAutorised,signout:signout,hasRole:hasRole};}","map":{"version":3,"sources":["C:/Users/Hugo/code/akatek/directual/directual-react-boilerplate/src/auth.js"],"names":["React","useState","useEffect","useContext","createContext","Directual","api","apiHost","authContext","ProvideAuth","children","auth","useProvideAuth","useAuth","user","setUser","sessionID","setSessionID","role","setRole","login","username","password","then","res","window","localStorage","setItem","signout","cb","logout","isAutorised","hasRole","roleCheck","sid","getItem","isAuthorize","status","token"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext, createContext } from \"react\";\r\nimport Directual from 'directual-api';\r\n\r\nconst api = new Directual({apiHost: '/'});\r\n\r\nexport const authContext = createContext();\r\n\r\nexport function ProvideAuth({ children }) {\r\n  const auth = useProvideAuth();\r\n  return <authContext.Provider value={auth}>{children}</authContext.Provider>;\r\n}\r\n\r\nexport const useAuth = () => {\r\n  return useContext(authContext);\r\n};\r\n\r\n// Provide hook that creates auth object and handles state\r\nfunction useProvideAuth() {\r\n  const [user, setUser] = useState(null);\r\n  const [sessionID, setSessionID] = useState(null);\r\n  const [role, setRole] = useState(null);\r\n\r\n  const login = (username, password) => {\r\n    return api.auth.login(username, password).then(res=>{\r\n      setUser(res.username)\r\n      setSessionID(res.sessionID)\r\n      setRole(res.role)\r\n      window.localStorage.setItem('sid', res.sessionID)\r\n    })\r\n  };\r\n\r\n  const signout = (cb) => {\r\n    return api.auth.logout('').then(res=>{\r\n      setUser(null)\r\n      setRole(null)\r\n      setSessionID(null)\r\n      window.localStorage.setItem('sid', null)\r\n      cb()\r\n    })\r\n  };\r\n\r\n  const isAutorised = () => {\r\n    return !!user\r\n  }\r\n\r\n  const hasRole = (roleCheck) => {\r\n    if(!roleCheck){\r\n      return true\r\n    }\r\n    return role === roleCheck\r\n  }\r\n\r\n  useEffect(() => {\r\n    let sid = window.localStorage.getItem('sid') || ''\r\n    api.auth.isAuthorize(sid, (status, token)=>{\r\n      if(status === true){\r\n        setUser(token.username)\r\n        setSessionID(token.token)\r\n        setRole(token.role)\r\n      }\r\n    })\r\n  }, []);\r\n\r\n  return {\r\n    user,\r\n    sessionID,\r\n    login,\r\n    isAutorised,\r\n    signout,\r\n    hasRole\r\n  };\r\n}"]},"metadata":{},"sourceType":"module"}